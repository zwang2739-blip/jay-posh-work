<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WORK | JAY POSH</title>
    
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* --- 全局設定 --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background-color: #f8f8f6;
            color: #000000; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
            user-select: none;
        }
        
        /* --- Header --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; 
            padding: 30px 50px;
            z-index: 1000; 
            pointer-events: none; 
        }
        .header-content { pointer-events: auto; display: flex; width: 100%; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; font-weight: 700; text-transform: uppercase; color: #000; text-decoration: none;}
        .nav-links { display: flex; gap: 30px; }
        .nav-link { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: #000; text-decoration: none; position: relative; }
        .nav-link.active::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 100%; height: 1px; background: #000; }

        /* --- 互動畫布 --- */
        #gallery-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            cursor: grab;
            /* 關鍵：初始隱藏，等 JS 計算完比例後再顯示 */
            opacity: 0; 
            transition: opacity 1s ease-out;
        }
        #gallery-canvas.loaded { opacity: 1; } /* JS 控制顯示 */
        #gallery-canvas.grabbing { cursor: grabbing; }

        /* --- 圖片樣式 --- */
        .gallery-img-container {
            position: absolute;
            top: 0; left: 0; 
            /* 動畫設定 */
            transition: transform 1s cubic-bezier(0.25, 0.8, 0.25, 1), width 1s ease, height 1s ease;
            transform-origin: center center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            background: #e0e0e0; /* 載入佔位色 */
        }
        
        .gallery-img-container img {
            width: 100%; height: 100%; 
            /* 關鍵修改：改用 contain 確保不裁切，或者在容器尺寸計算精準後用 cover 也可以 */
            /* 由於我們現在會精準計算容器比例，這裡用 cover 效果更好，不會有留白邊 */
            object-fit: cover;
            display: block;
            pointer-events: none; 
        }

        /* Hover 效果 (僅 Random 模式) */
        .gallery-img-container.random-hover:hover {
            z-index: 9999 !important;
            transform: scale(1.08) !important;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            transition: all 0.3s ease-out; /* Hover 反應快一點 */
        }

        /* --- 底部控制列 --- */
        .controls {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            z-index: 1000;
            display: flex; gap: 20px; align-items: center;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            padding: 12px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        .mode-btn {
            font-family: 'Inter', sans-serif; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px; cursor: pointer; color: #999; transition: color 0.3s; font-weight: 500;
        }
        .mode-btn.active { color: #000; font-weight: 700; }
        .toggle-track {
            width: 44px; height: 24px; background: #e0e0e0; border-radius: 20px; position: relative; cursor: pointer; transition: background 0.3s;
        }
        .toggle-thumb {
            width: 18px; height: 18px; background: #fff; border-radius: 50%; position: absolute; top: 3px; left: 3px; transition: left 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .toggle-track.linear-mode { background: #000; }
        .toggle-track.linear-mode .toggle-thumb { left: 23px; }

    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <a href="index.html" class="logo">JAY POSH</a>
            <nav class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="#" class="nav-link active">Work</a>
                <a href="index.html#experience" class="nav-link">Info</a>
            </nav>
        </div>
    </header>

    <div id="gallery-canvas">
        <div class="gallery-img-container"><img src="images/split-1.jpg"></div>
        <div class="gallery-img-container"><img src="images/split-2.jpg"></div>
        <div class="gallery-img-container"><img src="images/split-3.jpg"></div>
        <div class="gallery-img-container"><img src="images/split-4.jpg"></div>
        <div class="gallery-img-container"><img src="images/work3.jpg"></div>
        <div class="gallery-img-container"><img src="images/work49.jpg"></div>
        <div class="gallery-img-container"><img src="images/work60.jpg"></div>
        <div class="gallery-img-container"><img src="images/work50.jpg"></div>
        <div class="gallery-img-container"><img src="images/work55.jpg"></div>
        <div class="gallery-img-container"><img src="images/work35.jpg"></div>
        <div class="gallery-img-container"><img src="images/work14.jpg"></div>
        <div class="gallery-img-container"><img src="images/work36.jpg"></div>
        <div class="gallery-img-container"><img src="images/p5.jpg"></div>
        <div class="gallery-img-container"><img src="images/p2.jpg"></div>
        <div class="gallery-img-container"><img src="images/work11.jpg"></div>
        <div class="gallery-img-container"><img src="images/work12.jpg"></div>
        <div class="gallery-img-container"><img src="images/work13.jpg"></div>
        <div class="gallery-img-container"><img src="images/work33.jpg"></div>
        <div class="gallery-img-container"><img src="images/work38.jpg"></div>
        <div class="gallery-img-container"><img src="images/work39.jpg"></div>
        <div class="gallery-img-container"><img src="images/work52.jpg"></div>
        <div class="gallery-img-container"><img src="images/work53.jpg"></div>
        <div class="gallery-img-container"><img src="images/work54.jpg"></div>
        <div class="gallery-img-container"><img src="images/work65.jpg"></div>
        <div class="gallery-img-container"><img src="images/work72.jpg"></div>
        <div class="gallery-img-container"><img src="images/work74.jpg"></div>
    </div>

    <div class="controls">
        <div class="mode-btn active" id="btn-random">Random</div>
        <div class="toggle-track" id="mode-toggle">
            <div class="toggle-thumb"></div>
        </div>
        <div class="mode-btn" id="btn-linear">Linear</div>
    </div>

    <script>
        const canvas = document.getElementById('gallery-canvas');
        // 將 NodeList 轉為 Array 以便使用更多陣列方法
        const items = Array.from(document.querySelectorAll('.gallery-img-container'));
        const toggle = document.getElementById('mode-toggle');
        const btnRandom = document.getElementById('btn-random');
        const btnLinear = document.getElementById('btn-linear');

        let isLinear = false;
        let isDragging = false;
        let startX;
        let currentX = 0; 
        let dragX = 0;    

        // ==========================================
        // ★ 關鍵新功能：圖片預載入與比例計算 ★
        // ==========================================
        let imagesLoadedCount = 0;
        const totalImages = items.length;

        // 遍歷所有項目，等待圖片載入
        items.forEach(item => {
            const img = item.querySelector('img');
            
            // 定義載入完成後的動作
            const imageLoaded = () => {
                // 計算原始比例 (寬 / 高)
                const ratio = img.naturalWidth / img.naturalHeight;
                // 將比例存在 dataset 中供後續使用
                item.dataset.ratio = ratio;

                imagesLoadedCount++;
                // 如果全部都載入完成了
                if (imagesLoadedCount === totalImages) {
                    // 開始佈局
                    setRandomLayout();
                    // 淡入顯示畫布
                    canvas.classList.add('loaded');
                }
            };

            if (img.complete) {
                // 如果圖片已經在快取中，直接執行
                imageLoaded();
            } else {
                // 否則等待 onload 事件
                img.onload = imageLoaded;
            }
        });


        // --- Random 佈局計算 (使用動態比例) ---
        function setRandomLayout() {
            const vw = window.innerWidth;
            const vh = window.innerHeight;

            items.forEach((item, index) => {
                item.classList.add('random-hover');

                // 1. 隨機決定高度 (在 200px 到 450px 之間)
                const height = Math.floor(Math.random() * (450 - 200) + 200);
                // 2. 根據原始比例算出對應寬度 (重點!)
                const ratio = parseFloat(item.dataset.ratio);
                const width = height * ratio;

                // 3. 隨機位置 (保持在安全範圍內)
                const minX = vw * 0.02;
                const maxX = vw * 0.7; 
                const minY = vh * 0.05;  
                const maxY = vh * 0.55;  

                const x = Math.random() * (maxX - minX) + minX;
                const y = Math.random() * (maxY - minY) + minY;
                const rot = Math.random() * 30 - 15; // 加大旋轉角度

                // 4. 隨機層級，但保留原始順序的權重，減少完全遮擋
                const z = index + Math.floor(Math.random() * 10);

                item.style.width = `${width}px`;
                item.style.height = `${height}px`;
                item.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(${rot}deg)`;
                item.style.zIndex = z;
            });
        }

        // --- Linear 佈局計算 (使用動態比例) ---
        function setLinearLayout() {
            const vh = window.innerHeight;
            let currentLeft = window.innerWidth * 0.1; // 起始左邊距

            items.forEach((item, index) => {
                item.classList.remove('random-hover');

                // 1. 固定高度 (例如 400px)
                const fixedHeight = 400;
                // 2. 根據原始比例算出對應寬度 (重點!)
                const ratio = parseFloat(item.dataset.ratio);
                const width = fixedHeight * ratio;

                // 3. 垂直置中
                const y = (vh - fixedHeight) / 2;
                const x = currentLeft;

                item.style.width = `${width}px`;
                item.style.height = `${fixedHeight}px`;
                // 加上拖曳位移
                item.style.transform = `translate3d(${x + currentX + dragX}px, ${y}px, 0) rotate(0deg)`;
                // 依序排列層級，確保不會少一張
                item.style.zIndex = 100 + index; 

                // 累加左邊距
                currentLeft += width + 60; // 間距加大到 60px
            });
        }

        // 更新拖曳位置
        function updateDragPosition() {
            if (!isLinear) return;
            const vh = window.innerHeight;
            let currentLeft = window.innerWidth * 0.1;

            items.forEach((item) => {
                const width = parseFloat(item.style.width);
                const height = parseFloat(item.style.height);
                const y = (vh - height) / 2;
                
                item.style.transform = `translate3d(${currentLeft + currentX + dragX}px, ${y}px, 0) rotate(0deg)`;
                currentLeft += width + 60;
            });
        }

        // --- 事件監聽 ---
        canvas.addEventListener('mousedown', e => { if (!isLinear) return; isDragging = true; startX = e.clientX; canvas.classList.add('grabbing'); });
        window.addEventListener('mouseup', () => { if (!isDragging) return; isDragging = false; currentX += dragX; dragX = 0; canvas.classList.remove('grabbing'); });
        window.addEventListener('mousemove', e => { if (!isDragging) return; e.preventDefault(); dragX = e.clientX - startX; requestAnimationFrame(updateDragPosition); });
        canvas.addEventListener('touchstart', e => { if (!isLinear) return; isDragging = true; startX = e.touches[0].clientX; });
        canvas.addEventListener('touchend', () => { if (!isDragging) return; isDragging = false; currentX += dragX; dragX = 0; });
        canvas.addEventListener('touchmove', e => { if (!isDragging) return; dragX = e.touches[0].clientX - startX; requestAnimationFrame(updateDragPosition); });

        function switchMode(linear) {
            isLinear = linear;
            if (isLinear) {
                toggle.classList.add('linear-mode'); btnLinear.classList.add('active'); btnRandom.classList.remove('active');
                currentX = 0; dragX = 0;
                setLinearLayout();
            } else {
                toggle.classList.remove('linear-mode'); btnRandom.classList.add('active'); btnLinear.classList.remove('active');
                setRandomLayout();
            }
        }

        toggle.addEventListener('click', () => switchMode(!isLinear));
        btnRandom.addEventListener('click', () => switchMode(false));
        btnLinear.addEventListener('click', () => switchMode(true));
        window.addEventListener('resize', () => { if (isLinear) setLinearLayout(); else setRandomLayout(); });

        // 不再需要 setTimeout，因為我們改用圖片載入偵測了

    </script>
</body>
</html>